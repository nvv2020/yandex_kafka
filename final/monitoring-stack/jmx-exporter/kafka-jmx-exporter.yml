lowercaseOutputName: true
lowercaseOutputLabelNames: true
rules:
  # Брокеры Kafka
  - pattern: "kafka.server<type=(.+), name=(.+), clientId=(.+), topic=(.+), partition=(.*)><>Value"
    name: "kafka_server_$1_$2"
    labels:
      clientId: "$3"
      topic: "$4"
      partition: "$5"
    type: GAUGE

  - pattern: "kafka.server<type=(.+), name=(.+), clientId=(.+), topic=(.+), partition=(.*)><>Count"
    name: "kafka_server_$1_$2_total"
    labels:
      clientId: "$3"
      topic: "$4"
      partition: "$5"
    type: COUNTER

  - pattern: "kafka.server<type=(.+), name=(.+), clientId=(.+), topic=(.+)><>Value"
    name: "kafka_server_$1_$2"
    labels:
      clientId: "$3"
      topic: "$4"
    type: GAUGE

  - pattern: "kafka.server<type=(.+), name=(.+), clientId=(.+), topic=(.+)><>Count"
    name: "kafka_server_$1_$2_total"
    labels:
      clientId: "$3"
      topic: "$4"
    type: COUNTER

  - pattern: "kafka.server<type=(.+), name=(.+), clientId=(.+)><>Value"
    name: "kafka_server_$1_$2"
    labels:
      clientId: "$3"
    type: GAUGE

  - pattern: "kafka.server<type=(.+), name=(.+), clientId=(.+)><>Count"
    name: "kafka_server_$1_$2_total"
    labels:
      clientId: "$3"
    type: COUNTER

  - pattern: "kafka.server<type=(.+), name=(.+)><>Value"
    name: "kafka_server_$1_$2"
    type: GAUGE

  - pattern: "kafka.server<type=(.+), name=(.+)><>Count"
    name: "kafka_server_$1_$2_total"
    type: COUNTER

  # Контроллер Kafka
  - pattern: "kafka.controller<type=(.+), name=(.+)><>Value"
    name: "kafka_controller_$1_$2"
    type: GAUGE

  - pattern: "kafka.controller<type=(.+), name=(.+)><>Count"
    name: "kafka_controller_$1_$2_total"
    type: COUNTER

  # Координатор транзакций
  - pattern: "kafka.coordinator.transaction<type=(.+), name=(.+)><>Value"
    name: "kafka_coordinator_transaction_$1_$2"
    type: GAUGE

  # Координатор группы
  - pattern: "kafka.coordinator.group<type=(.+), name=(.+)><>Value"
    name: "kafka_coordinator_group_$1_$2"
    type: GAUGE

  - pattern: "kafka.coordinator.group<type=(.+), name=(.+)><>Count"
    name: "kafka_coordinator_group_$1_$2_total"
    type: COUNTER

  # Log Flush
  - pattern: "kafka.log<type=LogFlushStats, name=(.+)><>Count"
    name: "kafka_log_log_flush_stats_$1_total"
    type: COUNTER

  # Network
  - pattern: "kafka.network<type=(.+), name=(.+)><>Count"
    name: "kafka_network_$1_$2_total"
    type: COUNTER

  - pattern: "kafka.network<type=(.+), name=(.+)><>Value"
    name: "kafka_network_$1_$2"
    type: GAUGE

  # Producer/Consumer metrics
  - pattern: "kafka.producer<type=(.+), client-id=(.+)><>([a-z-]+)"
    name: "kafka_producer_$1_$3"
    labels:
      clientId: "$2"
    type: GAUGE

  - pattern: "kafka.consumer<type=(.+), client-id=(.+)><>([a-z-]+)"
    name: "kafka_consumer_$1_$3"
    labels:
      clientId: "$2"
    type: GAUGE

  # Zookeeper metrics
  - pattern: "kafka.server<type=ZooKeeperClientMetrics, name=(.+)><>Count"
    name: "kafka_zookeeper_$1_total"
    type: COUNTER

  # Общие JVM метрики
  - pattern: "java.lang<type=GarbageCollector, name=(.+)><>CollectionCount"
    name: "jvm_gc_collections_total"
    labels:
      gc: "$1"
    type: COUNTER

  - pattern: "java.lang<type=GarbageCollector, name=(.+)><>CollectionTime"
    name: "jvm_gc_collection_seconds_total"
    labels:
      gc: "$1"
    type: COUNTER

  - pattern: "java.lang<type=MemoryPool, name=(.+)><>Usage"
    name: "jvm_memory_pool_bytes_used"
    labels:
      pool: "$1"
    type: GAUGE

  - pattern: "java.lang<type=MemoryPool, name=(.+)><>PeakUsage"
    name: "jvm_memory_pool_bytes_used_peak"
    labels:
      pool: "$1"
    type: GAUGE

  - pattern: "java.lang<type=MemoryPool, name=(.+)><>CollectionUsage"
    name: "jvm_memory_pool_bytes_used_after_last_gc"
    labels:
      pool: "$1"
    type: GAUGE

  - pattern: "java.lang<type=OperatingSystem><>OpenFileDescriptorCount"
    name: "process_open_fds"
    type: GAUGE

  - pattern: "java.lang<type=Threading><>ThreadCount"
    name: "jvm_threads_current"
    type: GAUGE

  - pattern: "java.lang<type=Threading><>DaemonThreadCount"
    name: "jvm_threads_daemon"
    type: GAUGE